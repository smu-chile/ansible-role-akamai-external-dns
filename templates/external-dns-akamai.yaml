apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: external-dns-akamai
  namespace: default
spec:
  encryptedData:
    EXTERNAL_DNS_AKAMAI_ACCESS_TOKEN: AgBuNUGL7VEO58e4d3pQ5AtzSLindExacXTkpPnC4r5l4jAymaQrTHZDd6c57f0V6JgbJ97VVjR43h2/zqcg9pFfE8OA07o7feji4eOeIwoa5DmJQsL+ec++7HUc8o3Md5Ul0Cz1aDMemZnyF8Yy6QDnCWuYYlCUIjd6sedSPnsGxONDLNPjsv6fPLqMrenxLI7QzydQQ90ZTAJVoFxei9lIZIBR96UtIgvax0SldX8q0IIf1xIxeRFyXvqH1VKC4m1SYORJKlDsZqG/FzSoHm9/vNVuYQbRrFy0Udk6Q2B/QLxiHPaMac59/ncQfSXhzJWUT+sGH6Mp9V95OkZQ27/YHwn6JJHCTFGIYgfOFEKJqD8Fp/znd91HBROKkfENRMtNxzCdgzFXMm7rRWiccfWW0BVuHnEuySY+TyQnckqosY+i5Ax2JuSTvhB4fjAW1e9C04mPBu06fhRj8S2jOfEL9RRMl0m+KQVTEXFsmZsIu9YkPAd8aOubRAUkzv5gcMku4/J4YxZypEEGqR1sZWeQFiuyaY7tIy9V2oXnPTbIHxWA9FacvH22+l1GE+jD8ahPra2QxZmCsH7QktVFR9uUR43sqEjy9Dfx91TTL3fqo6LiN8ykCOiRgLWugGFZ3azq+c8b8x6mHWjKfl7QzjaN4NzBkDLAIGVuzUuO9hPlLB/QoNKv/DksZMFDCamMAj3T+08UduH07KYPFJAUrT3ZwCI2xhxk6p4GKKR95rLMkB2p1FZdsg==
    EXTERNAL_DNS_AKAMAI_CLIENT_SECRET: AgBTchYlTeOhqxsPzi9jAfG0/zlEaac4P34daGpA9EaM+NSiF1tBkFjLI6MNN9hhg9v4ZVwkNVHWdCKMt12RlBlTF25xxUfyqbHWvtlPOZ1ygrDmKNpIBVb7d9OzORSCetZyos4XXfFM0fOgf41I7grQ6l8jSBzIToj39dkboaJ7JzJXhi/Cqfzui2UF640y4FRvMffJzLIk6QXEkf3Xj92m3n8fUoa/e8hTAZ6rwhR31SFLbZvmADw69qsBsVQcY5hpjWUapf8JL6cHTKJ7V3UKK0Y0wKtKkvPjLKfiO3JNS45vOymP/4S2oBFb+s3aXh5qLYRkRTc6/391gbPmPWI6PwvL4NCQGk++4HUaC/VXQQJEHMMcUb49/OA2CPvQG+d6282mjSD9SOMh3BaQrMvg8jQUY9gqPXQNJgjM0mz6XK4KTgdXLsoM/jqEuryrbYle0TwxugEJtGmCL+oDlu6Vl24+FW5b7VahJpGxFDwYm1zL+HQufewyf+Fz1lQ8wDqedUnM8lZbV4B7vt/Y0SIR8HeU2JiEKUyCY3oaUCdnFCGSu6Yfc+1jD918REzANqf3ahRz1xSZizPq+T/fP4M9o0OQ2vRIlkkkxjxd9+jzg464ivmfJVQJV2MuuQmPLej1NH+Z3aEkDfHBP/Q072PiCiWpkYK4H5TrPqK9i8YfaKqeP0rpWkPFl+XFYq6o0aXYtSP764Jdq6S8oBVrTs9ftYGT23h+xxA0pT1JfrEFeZbnyDxun8BwZ3OduQ==
    EXTERNAL_DNS_AKAMAI_CLIENT_TOKEN: AgBNGXPMbCPr7rbgqhcssLtZj3XjGyP6fmCkxeQmI+Ofj0ukAa3dLyB3akbXxf+243rkzS346XcNjiqmd/4/QQqj88IX2Fz/dIym1HZcN5x7zKtXsNRGHLkl9umjlw+Gd/xDWnxR+bCPKE4XVLW6fXWGyN0iq4GrWceM/UY1Dh/Vc+BoVzeDXCI4aA9rSXP3XKSWczpe399CD+eucw1u5uKFUCUWv1ZRNd1PV1s2M6kmDRPdTWwwIUPmiv/0bia9sH9O45TcucsURk5qeh4oZPLepXS2PoYHZjbUeeYFt7t6JY+JDm7g4rU3DBa4xPi5lKuBEUYNqN4+u16KBiJ53b8+hK++E33E0iqV+9/+2S8z7G2drGi5Iwi1dpLcGFbnvfCvZimjFHukE4kuZrzrZF61sXJIdeXo85igoDtT25mc/r85CxkxwbQ1MIonraKDcfI+Z9421XJ63IIPjqG3j0wm+xlmPu72FzsgJ96I/rBgIANzOPPfawbdjAw02uDJGykQFA8Mo+t924BdVznoh7mFhwRUiFZcsWXZeZ/BQisoprXmfFlTh1SJYh68W9TGhQSLBicleDWZBIGe/2foHYhEnzgvHMOjswEmiKCmcgiJfRPtDNRyXLZahsFeL8Kk80LY5rKsK8D816OGWTpJHtlUQbZKhq47z9OXtyWwjaIUwaSl0Ow9o2G5F7IP+s8zOc8iGqM+hnhzybe70c1gkwpYBMQFQVZbyK48lu6YmCGm8moSUb5g6Q==
    EXTERNAL_DNS_AKAMAI_SERVICECONSUMERDOMAIN: AgCGrAGF00Gv91ZnlweT43W0XeOMTXwqaL8965ggrIrLW/Lj1O6Z38qWMbhKWLTIUGWz7ScE7TYF+E/eRFG58/M7xHUkRxx+ufb17teeCIy7tpD/ZtMxRVrnXoKAKUT1FIXHZmez+MPbGO90DdDe5ZVi3fF3Sh1B922GkaYlWvaa7w/waZS/69GmC1/BDVjvKqk06hfg/EMfWNuGSPnvxfD+llkxUY4/axpVkztbiC5YQJzuYd4EzlJrHU/02xq4a2NBiVVAYD1TuSUVny+WKTEno/L26qcf49Ye1dALd65FOko3gPW/bvBUTShTfsGjXmk59zZCPBfoz/REFbR6+hfWF0B+fuWmTapB8gNtrYUcvNxWnY/pxH7ob4/eSvJLj4ppZNgU7amn+7yL1tgAG7igjOu/RM5ClQVG2bQU/bZ/R1Tu6lZFBfUPSwO0NjiD3/aO7Pbud9188bPYZGA5X8MQtMmXg/R3OHXtzJTUZlu+//JhveEgC8ypGKr0uZI7MfFM9gc8zcse6pQ6A1Ua/vRoxDB3u5njDh6fvRqu5+pwneo7nJrgQu9hfxkD4+SEgP30gKmoL3OAccj84KumB5RpPkVWEEfmNtCOxywKlEwUWWWnYEfL7Xa4N/QbV2SqXxjcUuot5GrDYx8hsFZhRqGrnC0g0eqKtV9MQT0QCEzctVg91eQKlswl8QHGKPmjdpbu7wXNyNPXrZjgRBG/r9Wkguh0RsLy
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: external-dns-akamai
      namespace: default
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-dns
  namespace: default
---
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    name: external-dns
    namespace: default
  rules:
  - apiGroups: [""]
    resources: ["services","endpoints","pods"]
    verbs: ["get","watch","list"]
  - apiGroups: ["extensions","networking.k8s.io"]
    resources: ["ingresses"] 
    verbs: ["get","watch","list"]
  - apiGroups: [""]
    resources: ["nodes"]
    verbs: ["watch","list","get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: external-dns-viewer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: external-dns
subjects:
- kind: ServiceAccount
  name: external-dns
  namespace: default
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: external-dns
spec:
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: external-dns
  template:
    metadata:
      labels:
        app: external-dns
    spec:
      serviceAccountName: external-dns
      containers:
      - name: external-dns
        image: k8s.gcr.io/external-dns/external-dns:v0.11.0
        args:
        - --source=ingress  # or ingress or both
        - --source=service
        - --provider=akamai
        - --domain-filter={{ DOMAIN }} #smu-labs.cl
        # zone-id-filter may be specified as well to filter on contract ID
        - --registry=txt
        - --txt-owner-id={{ CLUSTER_NAME }}  #huawei-santiago-factory-front-develop
        - --txt-prefix=_txt_
        - --log-level=trace
        - --annotation-filter=external-dns.alpha.kubernetes.io/exclude notin (true)
        env:
        - name: EXTERNAL_DNS_AKAMAI_SERVICECONSUMERDOMAIN
          valueFrom:
            secretKeyRef:
              key: EXTERNAL_DNS_AKAMAI_SERVICECONSUMERDOMAIN
              name: external-dns-akamai
        - name: EXTERNAL_DNS_AKAMAI_CLIENT_TOKEN
          valueFrom:
            secretKeyRef:
              key: EXTERNAL_DNS_AKAMAI_CLIENT_TOKEN
              name: external-dns-akamai
        - name: EXTERNAL_DNS_AKAMAI_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              key: EXTERNAL_DNS_AKAMAI_CLIENT_SECRET
              name: external-dns-akamai
        - name: EXTERNAL_DNS_AKAMAI_ACCESS_TOKEN
          valueFrom:
            secretKeyRef:
              key: EXTERNAL_DNS_AKAMAI_ACCESS_TOKEN
              name: external-dns-akamai
